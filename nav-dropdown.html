<label for="combo-search">Navigate to a SiteLint violation example:</label>
<div role="combobox" aria-haspopup="listbox" aria-owns="combo-list" aria-expanded="false" style="position: relative;">
  <input id="combo-search" aria-autocomplete="list" aria-controls="combo-list" aria-activedescendant="" placeholder="Type to filter..." style="width: 100%; margin-bottom: 0.5em;" />
</div>
<ul id="combo-list" role="listbox" style="border: 1px solid #ccc; max-height: 300px; overflow-y: auto; padding-left: 0; list-style: none; margin-top: 0; display: none; background: white; position: absolute; z-index: 9999; width: 100%;"></ul>

<script>
  const input = document.getElementById("combo-search");
  const listbox = document.getElementById("combo-list");

  input.addEventListener("input", () => {
    const value = input.value.toLowerCase();
    listbox.innerHTML = "";
    const filtered = window.siteLintPages.filter(p => p.label.toLowerCase().includes(value));

    filtered.forEach((page, index) => {
      const li = document.createElement("li");
      li.id = "option-" + index;
      li.role = "option";
      li.textContent = page.label;
      li.tabIndex = 0;
      li.dataset.href = page.value;
      li.addEventListener("click", () => {
        window.location.href = page.value;
      });
      listbox.appendChild(li);
    });

    listbox.style.display = "block";
  });

  let currentIndex = -1;

  input.addEventListener("keydown", (e) => {
    const options = listbox.querySelectorAll('[role="option"]');

    if (e.key === "ArrowDown") {
      e.preventDefault();
      currentIndex = (currentIndex + 1) % options.length;
      updateActiveOption(options);
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      currentIndex = (currentIndex - 1 + options.length) % options.length;
      updateActiveOption(options);
    } else if (e.key === "Enter" && currentIndex >= 0) {
      e.preventDefault();
      options[currentIndex].click();
    }
  });

  function updateActiveOption(options) {
    options.forEach((opt, idx) => {
      if (idx === currentIndex) {
        opt.setAttribute("aria-selected", "true");
        input.setAttribute("aria-activedescendant", opt.id);
        opt.focus();
      } else {
        opt.removeAttribute("aria-selected");
      }
    });
  }
</script>
